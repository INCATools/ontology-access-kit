<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CHEBI Slimmer &mdash; oaklib  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=046fa432"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="CL Examples" href="../CL/index.html" />
    <link rel="prev" title="CHEBI Predicates" href="CHEBI-Predicates.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            oaklib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/index.html">The OAK Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../packages/index.html">OAK Library Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../datamodels/index.html">Datamodels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../howtos/index.html">How-To Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Commands/index.html">Commands</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Ontologies</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">CHEBI Examples</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="CHEBI-Predicates.html">CHEBI Predicates</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">CHEBI Slimmer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../CL/index.html">CL Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ENVO/index.html">ENVO Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GO/index.html">GO Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../HP/index.html">HP Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LOINC/index.html">LOINC Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../MAXO/index.html">MAXO Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../MONDO/index.html">MONDO Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../NCIT/index.html">NCIT Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../OBA/index.html">OBA Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../OMOP/index.html">OMOP Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../PHENIO/index.html">PhenIO Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../SchemaDotOrg/index.html">Schema.org Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Adapters/index.html">Adapter Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Interfaces/index.html">Interfaces Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">oaklib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Examples</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Ontologies</a></li>
          <li class="breadcrumb-item"><a href="index.html">CHEBI Examples</a></li>
      <li class="breadcrumb-item active">CHEBI Slimmer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/examples/Ontologies/CHEBI/CHEBI-Slimmer.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="CHEBI-Slimmer">
<h1>CHEBI Slimmer<a class="headerlink" href="#CHEBI-Slimmer" title="Link to this heading"></a></h1>
<p>Creates a simplified version of CHEBI by conflating all members of a conjugate clique.</p>
<section id="Initial-setup">
<h2>Initial setup<a class="headerlink" href="#Initial-setup" title="Link to this heading"></a></h2>
<p>Imports and use OAK to get an adapter to CHEBI sqlite database.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">oaklib</span> <span class="kn">import</span> <span class="n">get_adapter</span>
<span class="kn">from</span> <span class="nn">oaklib.utilities.obograph_utils</span> <span class="kn">import</span> <span class="n">reflexive</span>
<span class="kn">from</span> <span class="nn">tests.test_converters.test_obo_format</span> <span class="kn">import</span> <span class="n">canonical_path</span>

<span class="n">chebi</span> <span class="o">=</span> <span class="n">get_adapter</span><span class="p">(</span><span class="s2">&quot;sqlite:obo:chebi&quot;</span><span class="p">)</span>
<span class="c1"># session = get_adapter(&quot;sqlite:obo:chebi&quot;).session</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">chebi</span><span class="o">.</span><span class="n">session</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">oaklib.datamodels.vocabulary</span> <span class="kn">import</span> <span class="n">IS_A</span><span class="p">,</span> <span class="n">HAS_PART</span>
<span class="kn">from</span> <span class="nn">oaklib.interfaces</span> <span class="kn">import</span> <span class="n">OboGraphInterface</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chebi</span><span class="p">,</span> <span class="n">OboGraphInterface</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Set-up-vocabulary-constants">
<h2>Set up vocabulary constants<a class="headerlink" href="#Set-up-vocabulary-constants" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Relations</span>
<span class="n">CBO</span> <span class="o">=</span> <span class="s2">&quot;obo:chebi#is_conjugate_base_of&quot;</span>
<span class="n">CAO</span> <span class="o">=</span> <span class="s2">&quot;obo:chebi#is_conjugate_acid_of&quot;</span>
<span class="n">TAUTOMER_OF</span> <span class="o">=</span> <span class="s2">&quot;obo:chebi#is_tautomer_of&quot;</span>
<span class="n">ENANTIOMER_OF</span> <span class="o">=</span> <span class="s2">&quot;obo:chebi#is_enantiomer_of&quot;</span>
<span class="n">HAS_ROLE</span> <span class="o">=</span> <span class="s2">&quot;RO:0000087&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">CHEMICAL_ENTITY</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:24431&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># modify this for testing</span>
<span class="c1"># ROOT = AMINO_ACID</span>
<span class="n">ROOT</span> <span class="o">=</span> <span class="n">CHEMICAL_ENTITY</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">AMINO_ACID</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:33709&quot;</span>
<span class="n">AMINO_ACID_ANION</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:37022&quot;</span>
<span class="n">ION</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:24870&quot;</span>
<span class="n">ALPHA_AMINO_ACID</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:33704&quot;</span>
<span class="n">ALPHA_AMINO_ACID_ANION</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:33558&quot;</span>
<span class="n">ALPHA_AMINO_ACID_ZWITTERION</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:78608&quot;</span>
<span class="n">CYSTEINE_ZWITTERION</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:35237&quot;</span>
<span class="n">L_CYSTEINE_ZWITTERION</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:35235&quot;</span>
<span class="n">CYSTEINATE_1_MINUS</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:32456&quot;</span>
<span class="n">CYSTEINIUM</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:32458&quot;</span>
<span class="n">CORD_E</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:213754&quot;</span>
<span class="n">AAAE</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:46874&quot;</span>
<span class="n">CITRIC_ACID</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:30769&quot;</span>

<span class="n">AMMONIA</span><span class="o">=</span><span class="s2">&quot;CHEBI:16134&quot;</span>
<span class="n">AMMONIUM</span><span class="o">=</span><span class="s2">&quot;CHEBI:28938&quot;</span>
<span class="n">AZANIDE</span><span class="o">=</span><span class="s2">&quot;CHEBI:29337&quot;</span>
<span class="n">HYRDRIDONITRATE_2M</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:29340&quot;</span>
<span class="n">PECTIN</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:17309&quot;</span>
<span class="n">WATER</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:15377&quot;</span>

<span class="n">CONJ_EXCLUDES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">AMMONIA</span><span class="p">,</span> <span class="n">AMMONIUM</span><span class="p">,</span> <span class="n">AZANIDE</span><span class="p">,</span> <span class="n">HYRDRIDONITRATE_2M</span><span class="p">,</span> <span class="n">PECTIN</span>
<span class="p">}</span>
<br/><br/></pre></div>
</div>
</div>
</section>
<section id="All-labels">
<h2>All labels<a class="headerlink" href="#All-labels" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">chebi</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">chebi</span><span class="o">.</span><span class="n">entities</span><span class="p">())}</span>
<span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
200879
</pre></div></div>
</div>
</section>
<section id="Mappings">
<h2>Mappings<a class="headerlink" href="#Mappings" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">semsql.sqla.semsql</span> <span class="kn">import</span> <span class="n">Statements</span><span class="p">,</span> <span class="n">HasDbxrefStatement</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">HasDbxrefStatement</span><span class="p">)</span>
<span class="n">xrefs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">q</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;CHEBI:&quot;</span><span class="p">):</span>
        <span class="n">xrefs</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">xrefs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
161106
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Statements</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Statements</span><span class="o">.</span><span class="n">predicate</span> <span class="o">==</span> <span class="s2">&quot;obo:chebi/inchi&quot;</span><span class="p">)</span>
<span class="n">inchis</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="o">.</span><span class="n">subject</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">q</span><span class="p">}</span>
<span class="nb">len</span><span class="p">(</span><span class="n">inchis</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
177462
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">S3H</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:113373&quot;</span>
<span class="n">inchis</span><span class="p">[</span><span class="n">S3H</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;InChI=1S/C4H8O3.Na/c1-3(5)2-4(6)7;/h3,5H,2H2,1H3,(H,6,7);/q;+1/p-1&#39;
</pre></div></div>
</div>
</section>
<section id="Various-Relationships">
<h2>Various Relationships<a class="headerlink" href="#Various-Relationships" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">PMAP</span> <span class="o">=</span> <span class="p">{</span><span class="n">ENANTIOMER_OF</span><span class="p">:</span> <span class="s2">&quot;RO:0018039&quot;</span><span class="p">}</span>
<span class="n">preserved_rels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chebi</span><span class="o">.</span><span class="n">relationships</span><span class="p">(</span><span class="n">predicates</span><span class="o">=</span><span class="p">[</span><span class="n">HAS_PART</span><span class="p">,</span> <span class="n">HAS_ROLE</span><span class="p">,</span> <span class="n">ENANTIOMER_OF</span><span class="p">]))</span>
<span class="n">preserved_rels_by_subject</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">preserved_rels</span><span class="p">:</span>
    <span class="n">p_mapped</span> <span class="o">=</span> <span class="n">PMAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">preserved_rels_by_subject</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p_mapped</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">preserved_rels_by_subject</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
</section>
<section id="Retrieve-all-Charge-States">
<h2>Retrieve all Charge States<a class="headerlink" href="#Retrieve-all-Charge-States" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">semsql.sqla.semsql</span> <span class="kn">import</span> <span class="n">Statements</span><span class="p">,</span> <span class="n">HasDbxrefStatement</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">get_adapter</span><span class="p">(</span><span class="s2">&quot;sqlite:obo:chebi&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">session</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Statements</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Statements</span><span class="o">.</span><span class="n">predicate</span> <span class="o">==</span> <span class="s2">&quot;obo:chebi/charge&quot;</span><span class="p">)</span>
<span class="n">charges</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="o">.</span><span class="n">subject</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">q</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
189057
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">charges</span><span class="p">[</span><span class="n">L_CYSTEINE_ZWITTERION</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">charges</span><span class="p">[</span><span class="n">CYSTEINATE_1_MINUS</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">charges</span><span class="p">[</span><span class="n">CITRIC_ACID</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">AMINO_ACID_ANION</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">charges</span><span class="p">,</span> <span class="s2">&quot;X anion terms are agnostic to a SPECIFIC charge&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check against inchis</span>
<span class="n">inchi_skip</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">charges_by_inchi</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">inchi</span> <span class="ow">in</span> <span class="n">inchis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">toks</span> <span class="o">=</span> <span class="n">inchi</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="c1"># q is charge</span>
    <span class="n">qtoks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tok</span> <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">toks</span> <span class="k">if</span> <span class="n">tok</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">qtoks</span><span class="p">:</span>
        <span class="n">qtok</span> <span class="o">=</span> <span class="n">qtoks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;;&quot;</span> <span class="ow">in</span> <span class="n">qtok</span><span class="p">:</span>
            <span class="n">qtok</span> <span class="o">=</span> <span class="n">qtok</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">inchi_skip</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">qtok</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">qtok</span><span class="p">:</span>
            <span class="c1"># print(qtok)</span>
            <span class="n">mparts</span><span class="o">=</span> <span class="n">qtok</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mpart</span> <span class="ow">in</span> <span class="n">mparts</span><span class="p">:</span>
                    <span class="n">charge</span> <span class="o">*=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mpart</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">odd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">qtok</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">charges_by_inchi</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">charge</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">odd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                <span class="k">continue</span>
    <span class="c1"># p is protonation</span>
    <span class="n">ptoks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tok</span> <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">toks</span> <span class="k">if</span> <span class="n">tok</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">ptoks</span> <span class="ow">and</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ptok</span> <span class="o">=</span> <span class="n">ptoks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ptok</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

            <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">charges_by_inchi</span><span class="p">:</span>
                <span class="n">charges_by_inchi</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">charge</span> <span class="o">+</span> <span class="n">charges_by_inchi</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">charges_by_inchi</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">charge</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="nb">len</span><span class="p">(</span><span class="n">charges_by_inchi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
10687
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">errs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">charge</span> <span class="ow">in</span> <span class="n">charges_by_inchi</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">charges</span><span class="p">:</span>
        <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;inchi_charge&quot;</span><span class="p">:</span> <span class="n">charge</span><span class="p">,</span> <span class="s2">&quot;asserted_charge&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MISSING&quot;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">charges</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">!=</span> <span class="n">charge</span><span class="p">:</span>
        <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;inchi_charge&quot;</span><span class="p">:</span> <span class="n">charge</span><span class="p">,</span> <span class="s2">&quot;asserted_charge&quot;</span><span class="p">:</span> <span class="n">charges</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MISMATCH&quot;</span><span class="p">})</span>

<span class="n">cedf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errs</span><span class="p">)</span>
<span class="n">cedf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># charges_by_inchi[L_CYSTEINE_ZWITTERION]</span>
</pre></div>
</div>
</div>
</section>
<section id="Find-Conjugate-Cliques">
<h2>Find Conjugate Cliques<a class="headerlink" href="#Find-Conjugate-Cliques" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">conjrels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chebi</span><span class="o">.</span><span class="n">relationships</span><span class="p">(</span><span class="n">predicates</span><span class="o">=</span><span class="p">[</span><span class="n">CBO</span><span class="p">,</span> <span class="n">CAO</span><span class="p">,</span> <span class="n">TAUTOMER_OF</span><span class="p">]))</span>

<span class="n">conjrels</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">conjrels</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">CONJ_EXCLUDES</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">CONJ_EXCLUDES</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">conjrels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">15000</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">conjrels</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">CBO</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">8000</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">conjrels</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">TAUTOMER_OF</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1500</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">conjrels_by_subject</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">conjrels</span><span class="p">:</span>
    <span class="n">conjrels_by_subject</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">conjrels_by_subject</span><span class="p">[</span><span class="s2">&quot;CHEBI:142854&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;obo:chebi#is_conjugate_acid_of&#39;, &#39;CHEBI:142858&#39;),
 (&#39;obo:chebi#is_tautomer_of&#39;, &#39;CHEBI:142853&#39;)]
</pre></div></div>
</div>
</section>
<section id="Calculate-conjugate-graph-and-strongly-connected-components">
<h2>Calculate conjugate graph and strongly connected components<a class="headerlink" href="#Calculate-conjugate-graph-and-strongly-connected-components" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="c1"># find strongly connected components using cbos</span>

<span class="k">def</span> <span class="nf">calculate_conj_graph</span><span class="p">(</span><span class="n">conjrels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">:</span>
    <span class="n">conj_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">conjrels</span><span class="p">:</span>
        <span class="n">conj_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
        <span class="n">conj_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">conj_graph</span>

<span class="n">conj_graph</span> <span class="o">=</span> <span class="n">calculate_conj_graph</span><span class="p">(</span><span class="n">conjrels</span><span class="p">)</span>
<span class="n">sccs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">conj_graph</span><span class="p">))</span>
<span class="n">asserted_sccs</span> <span class="o">=</span> <span class="n">sccs</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sccs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8000</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">asserted_sccs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
8553
</pre></div></div>
</div>
</section>
<section id="Lexical-analysis">
<h2>Lexical analysis<a class="headerlink" href="#Lexical-analysis" title="Link to this heading"></a></h2>
<p>The CHEBI conjugate relationships are incomplete - here we aim to complete them doing a lexical analysis of the labels.</p>
<p>For example,</p>
<ul class="simple">
<li><p>foo acid anion</p></li>
<li><p>foo acid(1-)</p></li>
<li><p>foo acid zwitterion</p></li>
</ul>
<p>should be in a clique</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ensure ordering is such that greedy matching works</span>
<span class="n">suffixes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># odd edge cases - e.g. (2R)-glufosinate zwitterion(1-)</span>
    <span class="s2">&quot;zwitterion(1-)&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;zwitterion(2-)&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;anion(1-)&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="c1"># standard</span>
    <span class="s2">&quot;zwitterion&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;anion&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;cation&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span> <span class="s2">&quot;ion&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;ate&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;acid&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>

<span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">]:</span>
        <span class="n">suffixes</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">i</span><span class="si">}{</span><span class="n">sign</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sign</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">suffixes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;zwitterion(1-)&#39;: -1,
 &#39;zwitterion(2-)&#39;: -2,
 &#39;anion(1-)&#39;: -1,
 &#39;zwitterion&#39;: None,
 &#39;anion&#39;: (-99, -1),
 &#39;cation&#39;: (1, 99),
 &#39;ion&#39;: None,
 &#39;ate&#39;: None,
 &#39;acid&#39;: None,
 &#39;(1+)&#39;: 1,
 &#39;(1-)&#39;: -1,
 &#39;(2+)&#39;: 2,
 &#39;(2-)&#39;: -2,
 &#39;(3+)&#39;: 3,
 &#39;(3-)&#39;: -3,
 &#39;(4+)&#39;: 4,
 &#39;(4-)&#39;: -4,
 &#39;(5+)&#39;: 5,
 &#39;(5-)&#39;: -5,
 &#39;(6+)&#39;: 6,
 &#39;(6-)&#39;: -6,
 &#39;(7+)&#39;: 7,
 &#39;(7-)&#39;: -7,
 &#39;(8+)&#39;: 8,
 &#39;(8-)&#39;: -8,
 &#39;(9+)&#39;: 9,
 &#39;(9-)&#39;: -9}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">roles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chebi</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="s2">&quot;CHEBI:50906&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">IS_A</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://github.com/ebi-chebi/ChEBI/issues/4528</span>
<span class="n">EXCLUDE_STEMS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;disulfide&quot;</span><span class="p">,</span> <span class="s2">&quot;tartr&quot;</span><span class="p">,</span> <span class="s2">&quot;tartar&quot;</span><span class="p">,</span> <span class="s2">&quot;oxide&quot;</span><span class="p">,</span> <span class="s2">&quot;oxo&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="c1"># stem to chem is a mapping between a stem (e.g. &quot;L-lysine&quot;)</span>
<span class="c1"># and a dictionary of suffixes to CHEBI IDs</span>
<span class="n">stem_to_chem</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">stem_to_chem</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_norm</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># CHEBI is inconsistent, e.g. &quot;amino-acid&quot; vs &quot;amino acid&quot;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-acid&quot;</span><span class="p">,</span> <span class="s2">&quot; acid&quot;</span><span class="p">)</span>
    <span class="c1"># label = label.replace(&quot; acid&quot;, &quot;&quot;)</span>
    <span class="k">return</span> <span class="n">label</span>

<span class="k">def</span> <span class="nf">_de_acid</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; acid&quot;</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; acid&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ic&quot;</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ic&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ate&quot;</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ate&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">label</span>

<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
        <span class="c1"># TODO: eliminate non-classes</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">_norm</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">suffixes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">):</span>
            <span class="n">stem</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">stem</span> <span class="o">=</span> <span class="n">stem</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">stem_to_chem</span><span class="p">[</span><span class="n">_de_acid</span><span class="p">(</span><span class="n">stem</span><span class="p">)][</span><span class="n">suffix</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="k">break</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">_norm</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">stem_to_chem</span><span class="p">:</span>
        <span class="n">stem_to_chem</span><span class="p">[</span><span class="n">_de_acid</span><span class="p">(</span><span class="n">label</span><span class="p">)][</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>

<span class="k">for</span> <span class="n">stem</span> <span class="ow">in</span> <span class="n">EXCLUDE_STEMS</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">stem</span> <span class="ow">in</span> <span class="n">stem_to_chem</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">stem_to_chem</span><span class="p">[</span><span class="n">stem</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">stem_to_chem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30000</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stem_to_chem</span><span class="p">[</span><span class="s2">&quot;amino&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;cation&#39;: &#39;CHEBI:33703&#39;,
 &#39;acid&#39;: &#39;CHEBI:33709&#39;,
 &#39;zwitterion&#39;: &#39;CHEBI:35238&#39;,
 &#39;anion&#39;: &#39;CHEBI:37022&#39;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stem_to_chem</span><span class="p">[</span><span class="s2">&quot;oxo&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stem_to_chem</span><span class="p">[</span><span class="s2">&quot;citr&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;(4-)&#39;: &#39;CHEBI:132362&#39;,
 &#39;anion&#39;: &#39;CHEBI:133748&#39;,
 &#39;(3-)&#39;: &#39;CHEBI:16947&#39;,
 &#39;acid&#39;: &#39;CHEBI:30769&#39;,
 &#39;(1-)&#39;: &#39;CHEBI:35804&#39;,
 &#39;(2-)&#39;: &#39;CHEBI:35808&#39;}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">stem_to_chem</span><span class="p">[</span><span class="s2">&quot;citrate&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stem_to_chem</span><span class="p">[</span><span class="s2">&quot;(2R)-glufosin&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;ate&#39;: &#39;CHEBI:142853&#39;,
 &#39;zwitterion&#39;: &#39;CHEBI:142854&#39;,
 &#39;zwitterion(1-)&#39;: &#39;CHEBI:142858&#39;}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ensure edge case of (2R)-glufosinate zwitterion(1-) is taken care of</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">stem_to_chem</span><span class="p">[</span><span class="s2">&quot;(2R)-glufosinate zwitterion&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
31415
</pre></div></div>
</div>
</section>
<section id="Analysis:-Consistency-check-between-lexically-inferred-cliques-and-asserted-relationships">
<h2>Analysis: Consistency check between lexically inferred cliques and asserted relationships<a class="headerlink" href="#Analysis:-Consistency-check-between-lexically-inferred-cliques-and-asserted-relationships" title="Link to this heading"></a></h2>
<p>Some of this is reported here:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ebi-chebi/ChEBI/issues/4524">https://github.com/ebi-chebi/ChEBI/issues/4524</a></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">NO_REL</span> <span class="o">=</span> <span class="s2">&quot;NO_REL&quot;</span>
<span class="n">INVERSES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">CBO</span><span class="p">:</span> <span class="n">CAO</span><span class="p">,</span>
    <span class="n">CAO</span><span class="p">:</span> <span class="n">CBO</span><span class="p">,</span>
    <span class="n">TAUTOMER_OF</span><span class="p">:</span> <span class="n">TAUTOMER_OF</span><span class="p">,</span>
    <span class="n">NO_REL</span><span class="p">:</span> <span class="n">NO_REL</span>
<span class="p">}</span>

<span class="n">charge_problems</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">make_conjrefs</span><span class="p">(</span><span class="n">clique_suffix_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">stem</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">suffix1</span><span class="p">,</span> <span class="n">chem1</span> <span class="ow">in</span> <span class="n">clique_suffix_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ch1</span> <span class="o">=</span> <span class="n">suffixes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">suffix1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">actual_ch1</span> <span class="o">=</span> <span class="n">charges</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chem1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">chem1_label</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chem1</span><span class="p">,</span> <span class="n">chem1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch1</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">actual_ch1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">charge_problems</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">chem1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">chem1_label</span><span class="p">,</span> <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="n">ch1</span><span class="p">,</span> <span class="s2">&quot;asserted&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;problem&quot;</span><span class="p">:</span> <span class="s2">&quot;MISSING_CHARGE&quot;</span><span class="p">})</span>
                <span class="c1"># raise ValueError(f&quot;Missing charge for {chem1}&quot;)</span>
            <span class="k">elif</span> <span class="n">ch1</span> <span class="o">!=</span> <span class="n">actual_ch1</span><span class="p">:</span>
                <span class="n">charge_problems</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">chem1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">chem1_label</span><span class="p">,</span> <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="n">ch1</span><span class="p">,</span> <span class="s2">&quot;asserted&quot;</span><span class="p">:</span> <span class="n">actual_ch1</span><span class="p">,</span> <span class="s2">&quot;problem&quot;</span><span class="p">:</span> <span class="s2">&quot;CONFLICTING_CHARGE&quot;</span><span class="p">})</span>
                <span class="c1"># raise ValueError(f&quot;Charge mismatch for {chem1}: {ch1} vs {actual_ch1}&quot;)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch1</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">actual_ch1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">actual_ch1</span> <span class="o">&lt;</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">actual_ch1</span> <span class="o">&gt;</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">charge_problems</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">chem1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">chem1_label</span><span class="p">,</span> <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="n">ch1</span><span class="p">,</span> <span class="s2">&quot;asserted&quot;</span><span class="p">:</span> <span class="n">actual_ch1</span><span class="p">,</span> <span class="s2">&quot;problem&quot;</span><span class="p">:</span> <span class="s2">&quot;OUTSIDE_RANGE&quot;</span><span class="p">})</span>
                    <span class="c1"># raise ValueError(f&quot;Charge mismatch for {chem1}: {ch1} vs {actual_ch1}&quot;)</span>
        <span class="n">rels</span> <span class="o">=</span> <span class="n">conjrels_by_subject</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chem1</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">suffix2</span><span class="p">,</span> <span class="n">chem2</span> <span class="ow">in</span> <span class="n">clique_suffix_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">suffix1</span> <span class="o">==</span> <span class="n">suffix2</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">matched_preds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">actual_p</span> <span class="o">=</span> <span class="s2">&quot;NO_REL&quot;</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="n">chem2</span><span class="p">:</span>
                    <span class="n">actual_p</span> <span class="o">=</span> <span class="n">p</span>
                    <span class="n">matched_preds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched_preds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple matched preds: </span><span class="si">{</span><span class="n">matched_preds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">rev_matched_preds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">rels2</span> <span class="o">=</span> <span class="n">conjrels_by_subject</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">chem2</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">rels2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="n">chem1</span><span class="p">:</span>
                    <span class="n">inv_p</span> <span class="o">=</span> <span class="n">INVERSES</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                    <span class="n">rev_matched_preds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">inv_p</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">actual_p</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">inv_p</span> <span class="o">!=</span> <span class="n">actual_p</span><span class="p">:</span>
                            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preds mismatch: </span><span class="si">{</span><span class="n">actual_p</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">inv_p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">actual_p</span> <span class="o">=</span> <span class="n">inv_p</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rev_matched_preds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple matched inv preds: </span><span class="si">{</span><span class="n">rev_matched_preds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">matched_preds</span> <span class="o">!=</span> <span class="n">rev_matched_preds</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preds mismatch: </span><span class="si">{</span><span class="n">matched_preds</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">rev_matched_preds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">messages</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in clique </span><span class="si">{</span><span class="n">clique_suffix_dict</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">messages</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ch2</span> <span class="o">=</span> <span class="n">suffixes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">suffix2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ch1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ch2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">charge_diff</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch1</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch2</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">charge_diff</span> <span class="o">=</span> <span class="n">ch1</span> <span class="o">-</span> <span class="n">ch2</span>
                    <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">charge_diff</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch1</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch2</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">charge_diff</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">ch1</span> <span class="o">&lt;</span> <span class="n">ch2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">ch1</span> <span class="o">&gt;</span> <span class="n">ch2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch1</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch2</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">charge_diff</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ch2</span><span class="p">:</span>
                        <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ch2</span><span class="p">:</span>
                        <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">charge_diff</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">charge_diff_sign</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;suffix1&quot;</span><span class="p">:</span> <span class="n">suffix1</span> <span class="ow">or</span> <span class="s2">&quot;NO_SUFFIX&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;suffix2&quot;</span><span class="p">:</span> <span class="n">suffix2</span> <span class="ow">or</span> <span class="s2">&quot;NO_SUFFIX&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">actual_p</span><span class="p">,</span>
                            <span class="s2">&quot;chem1&quot;</span><span class="p">:</span> <span class="n">chem1</span><span class="p">,</span>
                            <span class="s2">&quot;chem2&quot;</span><span class="p">:</span> <span class="n">chem2</span><span class="p">,</span>
                            <span class="s2">&quot;charge_diff&quot;</span><span class="p">:</span> <span class="n">charge_diff</span><span class="p">,</span>
                            <span class="s2">&quot;charge_diff_sign&quot;</span><span class="p">:</span> <span class="n">charge_diff_sign</span><span class="p">,</span>
                            <span class="s2">&quot;stem&quot;</span><span class="p">:</span> <span class="n">stem</span><span class="p">,</span>
                            <span class="p">})</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="n">make_conjrefs</span><span class="p">(</span><span class="n">stem_to_chem</span><span class="p">[</span><span class="s2">&quot;amino&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;suffix1&#39;: &#39;cation&#39;,
  &#39;suffix2&#39;: &#39;acid&#39;,
  &#39;predicate&#39;: &#39;obo:chebi#is_conjugate_acid_of&#39;,
  &#39;chem1&#39;: &#39;CHEBI:33703&#39;,
  &#39;chem2&#39;: &#39;CHEBI:33709&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;cation&#39;,
  &#39;suffix2&#39;: &#39;zwitterion&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:33703&#39;,
  &#39;chem2&#39;: &#39;CHEBI:35238&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;cation&#39;,
  &#39;suffix2&#39;: &#39;anion&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:33703&#39;,
  &#39;chem2&#39;: &#39;CHEBI:37022&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;acid&#39;,
  &#39;suffix2&#39;: &#39;cation&#39;,
  &#39;predicate&#39;: &#39;obo:chebi#is_conjugate_base_of&#39;,
  &#39;chem1&#39;: &#39;CHEBI:33709&#39;,
  &#39;chem2&#39;: &#39;CHEBI:33703&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;acid&#39;,
  &#39;suffix2&#39;: &#39;zwitterion&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:33709&#39;,
  &#39;chem2&#39;: &#39;CHEBI:35238&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;acid&#39;,
  &#39;suffix2&#39;: &#39;anion&#39;,
  &#39;predicate&#39;: &#39;obo:chebi#is_conjugate_acid_of&#39;,
  &#39;chem1&#39;: &#39;CHEBI:33709&#39;,
  &#39;chem2&#39;: &#39;CHEBI:37022&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;zwitterion&#39;,
  &#39;suffix2&#39;: &#39;cation&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:35238&#39;,
  &#39;chem2&#39;: &#39;CHEBI:33703&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;zwitterion&#39;,
  &#39;suffix2&#39;: &#39;acid&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:35238&#39;,
  &#39;chem2&#39;: &#39;CHEBI:33709&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;zwitterion&#39;,
  &#39;suffix2&#39;: &#39;anion&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:35238&#39;,
  &#39;chem2&#39;: &#39;CHEBI:37022&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;anion&#39;,
  &#39;suffix2&#39;: &#39;cation&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:37022&#39;,
  &#39;chem2&#39;: &#39;CHEBI:33703&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;anion&#39;,
  &#39;suffix2&#39;: &#39;acid&#39;,
  &#39;predicate&#39;: &#39;obo:chebi#is_conjugate_base_of&#39;,
  &#39;chem1&#39;: &#39;CHEBI:37022&#39;,
  &#39;chem2&#39;: &#39;CHEBI:33709&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;anion&#39;,
  &#39;suffix2&#39;: &#39;zwitterion&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:37022&#39;,
  &#39;chem2&#39;: &#39;CHEBI:35238&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None}]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">make_conjrefs</span><span class="p">(</span><span class="n">stem_to_chem</span><span class="p">[</span><span class="s2">&quot;(2R)-glufosin&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;suffix1&#39;: &#39;ate&#39;,
  &#39;suffix2&#39;: &#39;zwitterion&#39;,
  &#39;predicate&#39;: &#39;obo:chebi#is_tautomer_of&#39;,
  &#39;chem1&#39;: &#39;CHEBI:142853&#39;,
  &#39;chem2&#39;: &#39;CHEBI:142854&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;ate&#39;,
  &#39;suffix2&#39;: &#39;zwitterion(1-)&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:142853&#39;,
  &#39;chem2&#39;: &#39;CHEBI:142858&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;zwitterion&#39;,
  &#39;suffix2&#39;: &#39;ate&#39;,
  &#39;predicate&#39;: &#39;obo:chebi#is_tautomer_of&#39;,
  &#39;chem1&#39;: &#39;CHEBI:142854&#39;,
  &#39;chem2&#39;: &#39;CHEBI:142853&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;zwitterion&#39;,
  &#39;suffix2&#39;: &#39;zwitterion(1-)&#39;,
  &#39;predicate&#39;: &#39;obo:chebi#is_conjugate_acid_of&#39;,
  &#39;chem1&#39;: &#39;CHEBI:142854&#39;,
  &#39;chem2&#39;: &#39;CHEBI:142858&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;zwitterion(1-)&#39;,
  &#39;suffix2&#39;: &#39;ate&#39;,
  &#39;predicate&#39;: &#39;NO_REL&#39;,
  &#39;chem1&#39;: &#39;CHEBI:142858&#39;,
  &#39;chem2&#39;: &#39;CHEBI:142853&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None},
 {&#39;suffix1&#39;: &#39;zwitterion(1-)&#39;,
  &#39;suffix2&#39;: &#39;zwitterion&#39;,
  &#39;predicate&#39;: &#39;obo:chebi#is_conjugate_base_of&#39;,
  &#39;chem1&#39;: &#39;CHEBI:142858&#39;,
  &#39;chem2&#39;: &#39;CHEBI:142854&#39;,
  &#39;charge_diff&#39;: None,
  &#39;charge_diff_sign&#39;: None,
  &#39;stem&#39;: None}]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">charge_problems</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">## warning - global</span>
<span class="n">lexical_conj_pairs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">stem</span><span class="p">,</span> <span class="n">clique</span> <span class="ow">in</span> <span class="n">stem_to_chem</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">lexical_conj_pairs</span> <span class="o">+=</span> <span class="n">make_conjrefs</span><span class="p">(</span><span class="n">clique</span><span class="p">,</span> <span class="n">stem</span><span class="p">)</span>

<span class="c1"># Reported here: https://github.com/ebi-chebi/ChEBI/issues/4525</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">charge_problems</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;tmp/charge_problems.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="nb">len</span><span class="p">(</span><span class="n">lexical_conj_pairs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
17166
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">chem_to_stem</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lexical_conj_pairs</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">_assign</span><span class="p">(</span><span class="n">chem</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stem</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">chem</span> <span class="ow">in</span> <span class="n">chem_to_stem</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chem_to_stem</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span> <span class="o">!=</span> <span class="n">stem</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflicting stems for </span><span class="si">{</span><span class="n">chem</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">chem_to_stem</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chem_to_stem</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span> <span class="o">=</span> <span class="n">stem</span>
    <span class="n">stem</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stem&quot;</span><span class="p">]</span>
    <span class="n">_assign</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;chem1&quot;</span><span class="p">],</span> <span class="n">stem</span><span class="p">)</span>
    <span class="n">_assign</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;chem2&quot;</span><span class="p">],</span> <span class="n">stem</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[117]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">calculate_conj_graph</span><span class="p">([(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;chem1&quot;</span><span class="p">],</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;chem2&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lexical_conj_pairs</span><span class="p">])</span>
<span class="n">lexical_sccs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">lexical_sccs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[117]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
7517
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[123]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># venn diagram of overlaps between</span>
<span class="c1"># - lexical_sccs</span>
<span class="c1"># - asserted_sccs</span>
<span class="c1"># - rhea_sccs</span>
<span class="c1"># - full_sccs</span>

<span class="kn">from</span> <span class="nn">matplotlib_venn</span> <span class="kn">import</span> <span class="n">venn3</span>
<span class="kn">from</span> <span class="nn">matplotlib_venn</span> <span class="kn">import</span> <span class="n">venn3_unweighted</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">hashable_scc</span><span class="p">(</span><span class="n">scc</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scc</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">my_venn3</span><span class="p">(</span><span class="n">sccs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">scc_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">hashable_scc</span><span class="p">(</span><span class="n">scc</span><span class="p">)</span> <span class="k">for</span> <span class="n">scc</span> <span class="ow">in</span> <span class="n">sccs</span><span class="p">]</span>
    <span class="n">venn3_unweighted</span><span class="p">(</span><span class="n">scc_sets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1">#venn3([set(lexical_sccs), set(asserted_sccs), set(rhea_sccs)], (&quot;Lexical&quot;, &quot;Asserted&quot;, &quot;Rhea&quot;))</span>
<span class="c1">#venn3([{1}, {1,2}, {1,2,tuple(&quot;a&quot; &quot;b&quot;)}])</span>
<span class="n">my_venn3</span><span class="p">([</span><span class="n">lexical_sccs</span><span class="p">,</span> <span class="n">asserted_sccs</span><span class="p">,</span> <span class="n">rhea_sccs</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;Lexical&quot;</span><span class="p">,</span> <span class="s2">&quot;Asserted&quot;</span><span class="p">,</span> <span class="s2">&quot;Rhea&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_Ontologies_CHEBI_CHEBI-Slimmer_57_0.png" src="../../../_images/examples_Ontologies_CHEBI_CHEBI-Slimmer_57_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># same as Euler diagram</span>
<span class="kn">from</span> <span class="nn">matplotlib_venn</span> <span class="kn">import</span> <span class="n">venn3_unweighted</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">lexical_conj_pairs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>suffix1</th>
      <th>suffix2</th>
      <th>predicate</th>
      <th>chem1</th>
      <th>chem2</th>
      <th>charge_diff</th>
      <th>charge_diff_sign</th>
      <th>stem</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>acid</td>
      <td>anion</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:100147</td>
      <td>CHEBI:62070</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>nalidix</td>
    </tr>
    <tr>
      <th>1</th>
      <td>anion</td>
      <td>acid</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:62070</td>
      <td>CHEBI:100147</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>nalidix</td>
    </tr>
    <tr>
      <th>2</th>
      <td>acid</td>
      <td>NO_SUFFIX</td>
      <td>NO_REL</td>
      <td>CHEBI:10046</td>
      <td>CHEBI:10045</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Wyerone</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NO_SUFFIX</td>
      <td>acid</td>
      <td>NO_REL</td>
      <td>CHEBI:10045</td>
      <td>CHEBI:10046</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Wyerone</td>
    </tr>
    <tr>
      <th>4</th>
      <td>acid</td>
      <td>ate</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:10072</td>
      <td>CHEBI:71201</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>xanthuren</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17161</th>
      <td>NO_SUFFIX</td>
      <td>(1-)</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:130073</td>
      <td>CHEBI:91301</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5,20-diHEPE</td>
    </tr>
    <tr>
      <th>17162</th>
      <td>(1-)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:9162</td>
      <td>CHEBI:79317</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>sinigrin</td>
    </tr>
    <tr>
      <th>17163</th>
      <td>NO_SUFFIX</td>
      <td>(1-)</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:79317</td>
      <td>CHEBI:9162</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>sinigrin</td>
    </tr>
    <tr>
      <th>17164</th>
      <td>ate</td>
      <td>acid</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:994</td>
      <td>CHEBI:995</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>cis,cis-2-amino-3-(3-oxoprop-1-enyl)but-2-enedio</td>
    </tr>
    <tr>
      <th>17165</th>
      <td>acid</td>
      <td>ate</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:995</td>
      <td>CHEBI:994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>cis,cis-2-amino-3-(3-oxoprop-1-enyl)but-2-enedio</td>
    </tr>
  </tbody>
</table>
<p>17166 rows × 8 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;charge_diff_sign&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">CAO</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>suffix1</th>
      <th>suffix2</th>
      <th>predicate</th>
      <th>chem1</th>
      <th>chem2</th>
      <th>charge_diff</th>
      <th>charge_diff_sign</th>
      <th>stem</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15585</th>
      <td>(1+)</td>
      <td>(5+)</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:83553</td>
      <td>CHEBI:82771</td>
      <td>-4.0</td>
      <td>-1.0</td>
      <td>N(4)-bis(aminopropyl)spermidine</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;charge_diff_sign&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">CBO</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>suffix1</th>
      <th>suffix2</th>
      <th>predicate</th>
      <th>chem1</th>
      <th>chem2</th>
      <th>charge_diff</th>
      <th>charge_diff_sign</th>
      <th>stem</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15584</th>
      <td>(5+)</td>
      <td>(1+)</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:82771</td>
      <td>CHEBI:83553</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>N(4)-bis(aminopropyl)spermidine</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;predicate&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
predicate
NO_REL                            3256
obo:chebi#is_conjugate_acid_of    6378
obo:chebi#is_conjugate_base_of    6378
obo:chebi#is_tautomer_of          1154
dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;tmp/conjrels.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># group by suffix1, suffix2, predicate, and count the number of rows</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;suffix1&quot;</span><span class="p">,</span> <span class="s2">&quot;suffix2&quot;</span><span class="p">,</span> <span class="s2">&quot;predicate&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="n">summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
suffix1         suffix2     predicate
acid            ate         obo:chebi#is_conjugate_acid_of    1522
ate             acid        obo:chebi#is_conjugate_base_of    1522
NO_SUFFIX       (1-)        obo:chebi#is_conjugate_acid_of    1332
(1-)            NO_SUFFIX   obo:chebi#is_conjugate_base_of    1332
NO_SUFFIX       (4-)        obo:chebi#is_conjugate_acid_of     673
                                                              ...
anion(1-)       acid        NO_REL                               1
(6-)            (2-)        NO_REL                               1
                (3-)        NO_REL                               1
                (4-)        NO_REL                               1
zwitterion(2-)  zwitterion  obo:chebi#is_conjugate_base_of       1
Length: 424, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">entropy</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">df</span>

<span class="c1"># Display the first few rows of the data to understand its structure</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Create a function to calculate entropy for each group</span>
<span class="k">def</span> <span class="nf">calculate_entropy</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entropy</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>

<span class="c1"># Grouping the data by suffix1 and suffix2, then calculating entropy for the predicates</span>
<span class="n">entropy_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;suffix1&#39;</span><span class="p">,</span> <span class="s1">&#39;suffix2&#39;</span><span class="p">])[</span><span class="s1">&#39;predicate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calculate_entropy</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plotting the entropy heatmap with reversed x-axis</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">entropy_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Entropy of Predicate Distribution by Suffix1 and Suffix2 (Reversed X-Axis)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Suffix2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Suffix1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_Ontologies_CHEBI_CHEBI-Slimmer_66_0.png" src="../../../_images/examples_Ontologies_CHEBI_CHEBI-Slimmer_66_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">pivot_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;suffix1&#39;</span><span class="p">,</span> <span class="s1">&#39;suffix2&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;predicate&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">pivot_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;tmp/pivot_table.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pivot_table</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>predicate</th>
      <th>suffix1</th>
      <th>suffix2</th>
      <th>NO_REL</th>
      <th>obo:chebi#is_conjugate_acid_of</th>
      <th>obo:chebi#is_conjugate_base_of</th>
      <th>obo:chebi#is_tautomer_of</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(1+)</td>
      <td>(1-)</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(1+)</td>
      <td>(2+)</td>
      <td>19</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(1+)</td>
      <td>(2-)</td>
      <td>3</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(1+)</td>
      <td>(3+)</td>
      <td>11</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(1+)</td>
      <td>(3-)</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>271</th>
      <td>zwitterion(1-)</td>
      <td>ate</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>272</th>
      <td>zwitterion(1-)</td>
      <td>zwitterion</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>273</th>
      <td>zwitterion(2-)</td>
      <td>(3-)</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>274</th>
      <td>zwitterion(2-)</td>
      <td>acid</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>275</th>
      <td>zwitterion(2-)</td>
      <td>zwitterion</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>276 rows × 6 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suffix1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;(1+)&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suffix2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NO_SUFFIX&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">CBO</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>suffix1</th>
      <th>suffix2</th>
      <th>predicate</th>
      <th>chem1</th>
      <th>chem2</th>
      <th>charge_diff</th>
      <th>charge_diff_sign</th>
      <th>stem</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3026</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:141055</td>
      <td>CHEBI:141057</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>validoxylamine B</td>
    </tr>
    <tr>
      <th>10936</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:58644</td>
      <td>CHEBI:32818</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>p-coumaroylagmatine</td>
    </tr>
    <tr>
      <th>12230</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:64003</td>
      <td>CHEBI:64004</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>N-allyl-6-chloro-1-(3-methylphenyl)-2,3,4,5-te...</td>
    </tr>
    <tr>
      <th>12330</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:64364</td>
      <td>CHEBI:10650</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>sumatriptan</td>
    </tr>
    <tr>
      <th>13406</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:72567</td>
      <td>CHEBI:6438</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>levobunolol</td>
    </tr>
    <tr>
      <th>14208</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:75297</td>
      <td>CHEBI:31057</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>13-deoxydaunorubicin</td>
    </tr>
    <tr>
      <th>14382</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:76278</td>
      <td>CHEBI:16299</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>dehydrocoformycin</td>
    </tr>
    <tr>
      <th>14672</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:76819</td>
      <td>CHEBI:15906</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>demethylmacrocin</td>
    </tr>
    <tr>
      <th>14698</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:76922</td>
      <td>CHEBI:77055</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>argemonine</td>
    </tr>
    <tr>
      <th>16426</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:86083</td>
      <td>CHEBI:86085</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>(Z)-p-coumaroylagmatine</td>
    </tr>
    <tr>
      <th>16452</th>
      <td>(1+)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:86380</td>
      <td>CHEBI:599440</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>amorolfine</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>suffix1</th>
      <th>suffix2</th>
      <th>predicate</th>
      <th>chem1</th>
      <th>chem2</th>
      <th>charge_diff</th>
      <th>charge_diff_sign</th>
      <th>stem</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>acid</td>
      <td>anion</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:100147</td>
      <td>CHEBI:62070</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>nalidix</td>
    </tr>
    <tr>
      <th>1</th>
      <td>anion</td>
      <td>acid</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:62070</td>
      <td>CHEBI:100147</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>nalidix</td>
    </tr>
    <tr>
      <th>2</th>
      <td>acid</td>
      <td>NO_SUFFIX</td>
      <td>NO_REL</td>
      <td>CHEBI:10046</td>
      <td>CHEBI:10045</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Wyerone</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NO_SUFFIX</td>
      <td>acid</td>
      <td>NO_REL</td>
      <td>CHEBI:10045</td>
      <td>CHEBI:10046</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Wyerone</td>
    </tr>
    <tr>
      <th>4</th>
      <td>acid</td>
      <td>ate</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:10072</td>
      <td>CHEBI:71201</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>xanthuren</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17161</th>
      <td>NO_SUFFIX</td>
      <td>(1-)</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:130073</td>
      <td>CHEBI:91301</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5,20-diHEPE</td>
    </tr>
    <tr>
      <th>17162</th>
      <td>(1-)</td>
      <td>NO_SUFFIX</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:9162</td>
      <td>CHEBI:79317</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>sinigrin</td>
    </tr>
    <tr>
      <th>17163</th>
      <td>NO_SUFFIX</td>
      <td>(1-)</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:79317</td>
      <td>CHEBI:9162</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>sinigrin</td>
    </tr>
    <tr>
      <th>17164</th>
      <td>ate</td>
      <td>acid</td>
      <td>obo:chebi#is_conjugate_base_of</td>
      <td>CHEBI:994</td>
      <td>CHEBI:995</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>cis,cis-2-amino-3-(3-oxoprop-1-enyl)but-2-enedio</td>
    </tr>
    <tr>
      <th>17165</th>
      <td>acid</td>
      <td>ate</td>
      <td>obo:chebi#is_conjugate_acid_of</td>
      <td>CHEBI:995</td>
      <td>CHEBI:994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>cis,cis-2-amino-3-(3-oxoprop-1-enyl)but-2-enedio</td>
    </tr>
  </tbody>
</table>
<p>17166 rows × 8 columns</p>
</div></div>
</div>
</section>
<section id="Create-is-a-map">
<h2>Create is-a map<a class="headerlink" href="#Create-is-a-map" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">is_as</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chebi</span><span class="o">.</span><span class="n">relationships</span><span class="p">(</span><span class="n">predicates</span><span class="o">=</span><span class="p">[</span><span class="n">IS_A</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">is_a_map</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">is_as</span><span class="p">:</span>
    <span class="n">is_a_map</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Fetch-Uniprot-Synonyms">
<h2>Fetch Uniprot Synonyms<a class="headerlink" href="#Fetch-Uniprot-Synonyms" title="Link to this heading"></a></h2>
<p>These are bio-friendly synonyms.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">semsql.sqla.semsql</span> <span class="kn">import</span> <span class="n">OwlAxiomAnnotation</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">OwlAxiomAnnotation</span><span class="p">)</span>
<span class="n">axiom_anns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">axiom_anns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
716075
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">up_axiom_anns</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">axiom_anns</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">annotation_predicate</span> <span class="o">==</span> <span class="s2">&quot;oio:hasDbXref&quot;</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">annotation_value</span> <span class="o">==</span> <span class="s2">&quot;UniProt&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">bio_syn_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="o">.</span><span class="n">subject</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">axiom_anns</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">annotation_predicate</span> <span class="o">==</span> <span class="s2">&quot;oio:hasDbXref&quot;</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">annotation_value</span> <span class="o">==</span> <span class="s2">&quot;UniProt&quot;</span><span class="p">}</span>
<span class="nb">len</span><span class="p">(</span><span class="n">bio_syn_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
16393
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">bio_syn_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
16393
</pre></div></div>
</div>
</section>
<section id="RHEA-pH-Mapping">
<h2>RHEA pH Mapping<a class="headerlink" href="#RHEA-pH-Mapping" title="Link to this heading"></a></h2>
<p>RHEA provides a table that maps CHEBI IDs to their pH 7.3 stable forms. The mapping may be reflexive print((e.g.a stable form will map to itself))</p>
<p>The mappings may not be complete - in particular only leaf nodes are mapped.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pystow</span>
<span class="n">ph_mapping_df</span> <span class="o">=</span> <span class="n">pystow</span><span class="o">.</span><span class="n">ensure_csv</span><span class="p">(</span><span class="s2">&quot;rhea&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://ftp.expasy.org/databases/rhea/tsv/chebi_pH7_3_mapping.tsv&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CHEBI&quot;</span><span class="p">,</span> <span class="s2">&quot;CHEBI_PH7_3&quot;</span><span class="p">]:</span>
    <span class="n">ph_mapping_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:&quot;</span> <span class="o">+</span> <span class="n">ph_mapping_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">ph_mapping_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CHEBI</th>
      <th>CHEBI_PH7_3</th>
      <th>ORIGIN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CHEBI:3</td>
      <td>CHEBI:3</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CHEBI:7</td>
      <td>CHEBI:7</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CHEBI:8</td>
      <td>CHEBI:8</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CHEBI:19</td>
      <td>CHEBI:19</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CHEBI:20</td>
      <td>CHEBI:20</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>119802</th>
      <td>CHEBI:691037</td>
      <td>CHEBI:691037</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>119803</th>
      <td>CHEBI:691622</td>
      <td>CHEBI:691622</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>119804</th>
      <td>CHEBI:741548</td>
      <td>CHEBI:132939</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>119805</th>
      <td>CHEBI:744019</td>
      <td>CHEBI:744019</td>
      <td>computation</td>
    </tr>
    <tr>
      <th>119806</th>
      <td>CHEBI:746859</td>
      <td>CHEBI:746859</td>
      <td>computation</td>
    </tr>
  </tbody>
</table>
<p>119807 rows × 3 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">ph_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ph_mapping_df</span><span class="p">[</span><span class="s1">&#39;CHEBI&#39;</span><span class="p">],</span> <span class="n">ph_mapping_df</span><span class="p">[</span><span class="s1">&#39;CHEBI_PH7_3&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">ph_mapping</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
119807
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we expected leaf and leaf-y nodes to be mapped</span>
<span class="k">assert</span> <span class="n">ph_mapping</span><span class="p">[</span><span class="n">CYSTEINATE_1_MINUS</span><span class="p">]</span> <span class="o">==</span> <span class="n">CYSTEINE_ZWITTERION</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">ph_mapping</span><span class="p">[</span><span class="n">CITRIC_ACID</span><span class="p">]</span> <span class="o">!=</span> <span class="n">CITRIC_ACID</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reflexivity</span>
<span class="k">assert</span> <span class="n">ph_mapping</span><span class="p">[</span><span class="n">L_CYSTEINE_ZWITTERION</span><span class="p">]</span> <span class="o">==</span> <span class="n">L_CYSTEINE_ZWITTERION</span>
<span class="k">assert</span> <span class="n">ph_mapping</span><span class="p">[</span><span class="n">CYSTEINE_ZWITTERION</span><span class="p">]</span> <span class="o">==</span> <span class="n">CYSTEINE_ZWITTERION</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">ph_mapping</span><span class="p">[</span><span class="n">WATER</span><span class="p">]</span> <span class="o">==</span> <span class="n">WATER</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># groupings are not mapped</span>
<span class="k">assert</span> <span class="n">AMINO_ACID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ph_mapping</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a reverse mapping</span>

<span class="n">rev_ph_mapping</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ph_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">rev_ph_mapping</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">rev_ph_mapping</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
111077
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">L_CYSTEINE_ZWITTERION</span> <span class="ow">in</span> <span class="n">rev_ph_mapping</span><span class="p">[</span><span class="n">L_CYSTEINE_ZWITTERION</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">CYSTEINATE_1_MINUS</span> <span class="ow">in</span> <span class="n">rev_ph_mapping</span><span class="p">[</span><span class="n">CYSTEINE_ZWITTERION</span><span class="p">]</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">rhea_sccs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rhea_singletons</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">clique</span> <span class="ow">in</span> <span class="n">rev_ph_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clique</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">rhea_sccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">clique</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rhea_singletons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clique</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">len</span><span class="p">(</span><span class="n">rhea_sccs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhea_singletons</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(8140, 102937)
</pre></div></div>
</div>
</section>
<section id="Pick-Canonical-from-Conjugate-Cliques">
<h2>Pick Canonical from Conjugate Cliques<a class="headerlink" href="#Pick-Canonical-from-Conjugate-Cliques" title="Link to this heading"></a></h2>
<p>For each clique, pick the canonical term.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">arbitrary_canonical_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">def</span> <span class="nf">pick_canonical</span><span class="p">(</span><span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pick the canonical term from a list of ids.</span>

<span class="sd">    Priority order:</span>

<span class="sd">    1. pH mapping</span>
<span class="sd">    2. Uniprot synonyms</span>
<span class="sd">    3. Charge 0</span>

<span class="sd">    :param ids:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ensure deterministic order</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ph_mapping</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ph_mapping</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">bio_syn_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">id</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">charges</span> <span class="ow">and</span> <span class="n">charges</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">id</span>
    <span class="c1"># prioritize shorter</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">charges</span><span class="p">:</span>
            <span class="c1"># last resort</span>
            <span class="k">return</span> <span class="nb">id</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">arbitrary_canonical_map</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># raise ValueError(f&quot;Could not find canonical for {ids}&quot;)</span>

<span class="k">assert</span> <span class="n">pick_canonical</span><span class="p">([</span><span class="n">CITRIC_ACID</span><span class="p">])</span> <span class="o">==</span> <span class="n">ph_mapping</span><span class="p">[</span><span class="n">CITRIC_ACID</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">pick_canonical</span><span class="p">([</span><span class="n">L_CYSTEINE_ZWITTERION</span><span class="p">])</span> <span class="o">==</span> <span class="n">L_CYSTEINE_ZWITTERION</span>
<span class="k">assert</span> <span class="n">pick_canonical</span><span class="p">([</span><span class="n">CYSTEINE_ZWITTERION</span><span class="p">,</span> <span class="n">CYSTEINATE_1_MINUS</span><span class="p">,</span> <span class="n">CYSTEINIUM</span><span class="p">])</span> <span class="o">==</span> <span class="n">CYSTEINE_ZWITTERION</span>
<span class="k">assert</span> <span class="n">pick_canonical</span><span class="p">([</span><span class="n">AMINO_ACID</span><span class="p">,</span> <span class="n">AMINO_ACID_ANION</span><span class="p">])</span> <span class="o">==</span> <span class="n">AMINO_ACID</span>
<span class="k">assert</span> <span class="n">pick_canonical</span><span class="p">([</span><span class="n">ALPHA_AMINO_ACID</span><span class="p">,</span> <span class="n">ALPHA_AMINO_ACID_ANION</span><span class="p">,</span> <span class="n">ALPHA_AMINO_ACID_ZWITTERION</span><span class="p">])</span> <span class="o">==</span> <span class="n">ALPHA_AMINO_ACID_ZWITTERION</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">pick_canonical</span><span class="p">([</span><span class="n">ALPHA_AMINO_ACID</span><span class="p">,</span> <span class="n">ALPHA_AMINO_ACID_ANION</span><span class="p">,</span> <span class="n">ALPHA_AMINO_ACID_ZWITTERION</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;CHEBI:78608&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Tuple</span>


<span class="k">def</span> <span class="nf">create_canonical_map</span><span class="p">(</span><span class="n">scc_sets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a mapping between canonical and members of the strongly connected components</span>
<span class="sd">    :param scc_sets:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">canonical_to_members</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">scc</span> <span class="ow">in</span> <span class="n">scc_sets</span><span class="p">:</span>
        <span class="n">canonical</span> <span class="o">=</span> <span class="n">pick_canonical</span><span class="p">(</span><span class="n">scc</span><span class="p">)</span>
        <span class="n">canonical_to_members</span><span class="p">[</span><span class="n">canonical</span><span class="p">]</span> <span class="o">=</span> <span class="n">scc</span>
    <span class="n">members_to_canonical</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">canonical_to_members</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">canonical_to_members</span><span class="p">,</span> <span class="n">members_to_canonical</span><span class="p">)</span>

<span class="n">canonical_to_members</span><span class="p">,</span> <span class="n">members_to_canonical</span> <span class="o">=</span> <span class="n">create_canonical_map</span><span class="p">(</span><span class="n">sccs</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">canonical_to_members</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8000</span>
<span class="k">assert</span> <span class="n">members_to_canonical</span><span class="p">[</span><span class="n">CYSTEINE_ZWITTERION</span><span class="p">]</span> <span class="o">==</span> <span class="n">CYSTEINE_ZWITTERION</span>
<span class="k">assert</span> <span class="n">members_to_canonical</span><span class="p">[</span><span class="n">CYSTEINATE_1_MINUS</span><span class="p">]</span> <span class="o">==</span> <span class="n">CYSTEINE_ZWITTERION</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># assert CITRIC_ACID in members_to_canonical</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1">##</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># assess completeness of the sccs</span>
<span class="n">missing_in_conjugate_sccs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chem</span> <span class="ow">in</span> <span class="n">stem_to_chem</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">chem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">canonical_to_members</span><span class="p">:</span>
        <span class="n">missing_in_conjugate_sccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chem</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">missing_in_conjugate_sccs</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
31415
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">missing_in_lexical_analysis</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chem</span> <span class="ow">in</span> <span class="n">canonical_to_members</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">chem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chem_to_stem</span><span class="p">:</span>
        <span class="n">missing_in_lexical_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chem</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">missing_in_lexical_analysis</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1927
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">vmap</span> <span class="ow">in</span> <span class="n">stem_to_chem</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">vmap</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">vmap</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v1</span> <span class="o">&gt;</span> <span class="n">v2</span><span class="p">:</span>
                <span class="n">rel</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conjrels</span><span class="p">:</span>
                    <span class="n">conjrels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>
                <span class="c1"># conj_graph.add_edge(v1, v2))</span>
<span class="n">conj_graph</span> <span class="o">=</span> <span class="n">calculate_conj_graph</span><span class="p">(</span><span class="n">conjrels</span><span class="p">)</span>
<span class="n">full_sccs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">conj_graph</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">full_sccs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
9321
</pre></div></div>
</div>
<p>This number is the total number of cliques we will use</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">canonical_to_members</span><span class="p">,</span> <span class="n">members_to_canonical</span> <span class="o">=</span> <span class="n">create_canonical_map</span><span class="p">(</span><span class="n">full_sccs</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">canonical_to_members</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9000</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span><span class="p">[</span><span class="n">members_to_canonical</span><span class="p">[</span><span class="n">AMINO_ACID</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;amino acid&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">members_to_canonical</span><span class="p">[</span><span class="n">AMINO_ACID_ANION</span><span class="p">]</span> <span class="o">==</span> <span class="n">AMINO_ACID</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">members_to_canonical</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
19624
</pre></div></div>
</div>
</section>
<section id="Exclusion-List">
<h2>Exclusion List<a class="headerlink" href="#Exclusion-List" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[84]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">ions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chebi</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">ION</span><span class="p">,</span> <span class="p">[</span><span class="n">IS_A</span><span class="p">]))</span>
<span class="n">exclusion_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ion</span> <span class="k">for</span> <span class="n">ion</span> <span class="ow">in</span> <span class="n">ions</span> <span class="k">if</span> <span class="n">ion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">canonical_to_members</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">exclusion_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
6762
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># assert AAAC in exclusion_list, f&quot;expected {AAAC} in exclusion_list&quot;</span>
<span class="k">assert</span> <span class="n">CITRIC_ACID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclusion_list</span>
<span class="k">assert</span> <span class="n">AMINO_ACID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclusion_list</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[87]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rewire</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rewire an ID to its canonical form, if it is not in the exclusion list</span>
<span class="sd">    :param id:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rewired</span> <span class="o">=</span>  <span class="n">members_to_canonical</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rewired</span> <span class="ow">in</span> <span class="n">exclusion_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">rewired</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">rewire</span><span class="p">(</span><span class="n">AAAE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;CHEBI:83410&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[89]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">rewire</span><span class="p">(</span><span class="n">AAAE</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AAAE</span>
<span class="k">assert</span> <span class="n">rewire</span><span class="p">(</span><span class="n">AAAE</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclusion_list</span>
</pre></div>
</div>
</div>
</section>
<section id="Generate-Ontology">
<h2>Generate Ontology<a class="headerlink" href="#Generate-Ontology" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[90]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>



<span class="k">class</span> <span class="nc">Term</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">stanza_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Term&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">synonyms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xrefs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alt_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">parents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">relationships</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">inchi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">physiologically_stable_form</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">comments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">as_obo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\{&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stanza_type</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;id: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;synonym: </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">synonyms</span> <span class="ow">or</span> <span class="p">[]]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;alt_id: </span><span class="si">{</span><span class="n">alt_id</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">alt_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_ids</span> <span class="ow">or</span> <span class="p">[]]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;is_a: </span><span class="si">{</span><span class="n">is_a</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">is_a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="ow">or</span> <span class="p">[]]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;xref: </span><span class="si">{</span><span class="n">xref</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">xref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrefs</span> <span class="ow">or</span> <span class="p">[]]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;relationship: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span> <span class="ow">or</span> <span class="p">[]]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;comment: </span><span class="si">{</span><span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;property_value: chemrof:inchi_string </span><span class="se">\&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inchi</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> xsd:string&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inchi</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;property_value: chemrof:has_physiologically_stable_form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">physiologically_stable_form</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">physiologically_stable_form</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Ontology</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Term</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">as_obo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;ontology: chebi-slim&quot;</span><span class="p">,</span>
             <span class="s2">&quot;idspace: chemrof https://w3id.org/chemrof/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">as_obo</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">])</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">BAD_SUFFIXES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;zwitterion&quot;</span><span class="p">,</span> <span class="s2">&quot;ion&quot;</span><span class="p">,</span> <span class="s2">&quot;(1+)&quot;</span><span class="p">,</span> <span class="s2">&quot;(2+)&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">make_term</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Term</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a term from an ID</span>

<span class="sd">    :param id:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">exclusion_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">members_to_canonical</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">:</span>
        <span class="c1"># non-canonical members are not included</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1">#if id not in initial_terms:</span>
    <span class="c1">#    # filter for testing</span>
    <span class="c1">#    return None</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">bio_syn_map</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">bio_syn_map</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">BAD_SUFFIXES</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">suffix</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">term</span> <span class="o">=</span> <span class="n">Term</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">alt_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">canonical_to_members</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ph_mapping</span><span class="p">:</span>
        <span class="n">term</span><span class="o">.</span><span class="n">physiologically_stable_form</span> <span class="o">=</span> <span class="n">ph_mapping</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">alt_ids</span><span class="p">:</span>
        <span class="n">term</span><span class="o">.</span><span class="n">alt_ids</span> <span class="o">=</span> <span class="n">alt_ids</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alt_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">equiv_set</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">+</span> <span class="n">alt_ids</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">alt_id</span> <span class="ow">in</span> <span class="n">equiv_set</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">is_a_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alt_id</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">rewired_parent</span> <span class="o">=</span> <span class="n">rewire</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rewired_parent</span> <span class="ow">and</span> <span class="n">rewired_parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">term</span><span class="o">.</span><span class="n">parents</span><span class="p">:</span>
                <span class="n">term</span><span class="o">.</span><span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rewired_parent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rewired_parent</span> <span class="o">!=</span> <span class="n">parent</span> <span class="ow">or</span> <span class="n">alt_id</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">:</span>
                    <span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parent </span><span class="si">{</span><span class="n">rewired_parent</span><span class="si">}</span><span class="s2"> was rewired from </span><span class="si">{</span><span class="n">alt_id</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="n">preserved_rels_by_subject</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alt_id</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">rewired_o</span> <span class="o">=</span> <span class="n">rewire</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rewired_o</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">rewired_o</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">term</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
                <span class="n">term</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">rewired_o</span><span class="p">))</span>
        <span class="c1"># TODO: xrefs</span>
        <span class="k">for</span> <span class="n">xref</span> <span class="ow">in</span> <span class="n">xrefs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alt_id</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">xref</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;PMID:&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">term</span><span class="o">.</span><span class="n">xrefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xref</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alt_id</span> <span class="ow">in</span> <span class="n">inchis</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">term</span><span class="o">.</span><span class="n">inchi</span><span class="p">:</span>
                <span class="n">term</span><span class="o">.</span><span class="n">inchi</span> <span class="o">=</span> <span class="n">inchis</span><span class="p">[</span><span class="n">alt_id</span><span class="p">]</span>
    <span class="n">term</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="n">comments</span>
    <span class="k">return</span> <span class="n">term</span>


<span class="c1">#assert L_CYSTEINE_ZWITTERION in initial_terms</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">make_term</span><span class="p">(</span><span class="n">L_CYSTEINE_ZWITTERION</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;L-cysteine&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Term]
id: CHEBI:35235
name: L-cysteine
alt_id: CHEBI:32442
alt_id: CHEBI:17561
alt_id: CHEBI:32445
alt_id: CHEBI:32443
is_a: CHEBI:35237
is_a: CHEBI:59869
is_a: CHEBI:26650
is_a: CHEBI:83813
xref: Gmelin:49993
xref: Reaxys:4128886
xref: Gmelin:325857
xref: Beilstein:4128886
xref: YMDB:YMDB00046
xref: Wikipedia:Cysteine
xref: Reaxys:1721408
xref: PDBeChem:CYS
xref: MetaCyc:CYS
xref: KNApSAcK:C00001351
xref: KEGG:D00026
xref: KEGG:C00097
xref: HMDB:HMDB0000574
xref: Gmelin:49991
xref: ECMDB:ECMDB00574
xref: Drug_Central:769
xref: DrugBank:DB00151
xref: CAS:52-90-4
xref: Beilstein:1721408
xref: Gmelin:325860
xref: Reaxys:5921923
xref: Gmelin:325856
xref: Beilstein:5921923
relationship: RO:0018039 CHEBI:35236
relationship: RO:0000087 CHEBI:78675
relationship: RO:0000087 CHEBI:64577
relationship: RO:0000087 CHEBI:77703
relationship: RO:0000087 CHEBI:77746
comment: Parent CHEBI:59869 was rewired from CHEBI:32442 to CHEBI:59814; Parent CHEBI:26650 was rewired from CHEBI:17561 to CHEBI:26650; Parent CHEBI:83813 was rewired from CHEBI:17561 to CHEBI:83813
property_value: chemrof:inchi_string &#34;InChI=1S/C3H7NO2S/c4-2(1-7)3(5)6/h2,7H,1,4H2,(H,5,6)/t2-/m0/s1&#34; xsd:string
property_value: chemrof:has_physiologically_stable_form CHEBI:35235

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">rewire</span><span class="p">(</span><span class="n">is_a_map</span><span class="p">[</span><span class="n">CORD_E</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclusion_list</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[93]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">make_term</span><span class="p">(</span><span class="n">CORD_E</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Term]
id: CHEBI:213754
name: Cordycepamide E
is_a: CHEBI:83410
comment: Parent CHEBI:83410 was rewired from CHEBI:213754 to CHEBI:46874
property_value: chemrof:inchi_string &#34;InChI=1S/C15H19NO4/c1-9(2)13-14(18)16(3)12(15(19)20-13)8-10-4-6-11(17)7-5-10/h4-7,9,12-13,17H,8H2,1-3H3/t12-,13+/m0/s1&#34; xsd:string
property_value: chemrof:has_physiologically_stable_form CHEBI:213754

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="c1"># assert CYSTEINE_ZWITTERION in initial_terms</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">make_term</span><span class="p">(</span><span class="n">CYSTEINE_ZWITTERION</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;cysteine&quot;</span>
<span class="k">assert</span> <span class="s2">&quot;CHEBI:78608&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">parents</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Term]
id: CHEBI:35237
name: cysteine
alt_id: CHEBI:32458
alt_id: CHEBI:32456
alt_id: CHEBI:32457
alt_id: CHEBI:15356
is_a: CHEBI:33709
is_a: CHEBI:78608
is_a: CHEBI:26834
is_a: CHEBI:62031
xref: Gmelin:49992
xref: Gmelin:325859
xref: Reaxys:4128885
xref: Gmelin:363235
xref: Beilstein:4128885
xref: Gmelin:49990
xref: Wikipedia:Cysteine
xref: Reaxys:1721406
xref: KNApSAcK:C00007323
xref: KNApSAcK:C00001351
xref: KEGG:C00736
xref: Gmelin:2933
xref: CAS:3374-22-9
xref: Beilstein:1721406
relationship: BFO:0000051 CHEBI:50326
relationship: RO:0000087 CHEBI:78675
comment: Parent CHEBI:33709 was rewired from CHEBI:35237 to CHEBI:35238; Parent CHEBI:78608 was rewired from CHEBI:32458 to CHEBI:33719; Parent CHEBI:26834 was rewired from CHEBI:32456 to CHEBI:63470; Parent CHEBI:62031 was rewired from CHEBI:15356 to CHEBI:26167
property_value: chemrof:inchi_string &#34;InChI=1S/C3H7NO2S/c4-2(1-7)3(5)6/h2,7H,1,4H2,(H,5,6)&#34; xsd:string
property_value: chemrof:has_physiologically_stable_form CHEBI:35237

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">is_a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">parents</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">is_a</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">is_a</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CHEBI:33709 amino acid
CHEBI:78608 alpha-amino acid zwitterion
CHEBI:26834 sulfur-containing amino acid
CHEBI:62031 polar amino acid zwitterion
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">make_term</span><span class="p">(</span><span class="n">ALPHA_AMINO_ACID_ZWITTERION</span><span class="p">)</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Term]
id: CHEBI:78608
name: an alpha-amino acid
alt_id: CHEBI:33558
alt_id: CHEBI:33704
alt_id: CHEBI:33719
is_a: CHEBI:33709
xref: MetaCyc:Alpha-Amino-Acids
xref: KEGG:C05167
xref: KEGG:C00045
comment: Parent CHEBI:33709 was rewired from CHEBI:78608 to CHEBI:35238
property_value: chemrof:has_physiologically_stable_form CHEBI:78608

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[97]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">make_term</span><span class="p">(</span><span class="s2">&quot;CHEBI:25944&quot;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">comments</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Term]
id: CHEBI:25944
name: pesticide
is_a: CHEBI:33232
xref: Wikipedia:Pesticide

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">GLU_1M</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:14321&quot;</span>
<span class="k">assert</span> <span class="n">preserved_rels_by_subject</span><span class="p">[</span><span class="n">GLU_1M</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">make_term</span><span class="p">(</span><span class="n">GLU_1M</span><span class="p">)</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Term]
id: CHEBI:14321
name: glutamate
alt_id: CHEBI:18237
alt_id: CHEBI:29987
is_a: CHEBI:78608
is_a: CHEBI:62031
xref: Gmelin:327908
xref: Wikipedia:Glutamic_acid
xref: Reaxys:1723799
xref: KNApSAcK:C00019577
xref: KNApSAcK:C00001358
xref: KEGG:D04341
xref: KEGG:C00302
xref: Gmelin:101971
xref: CAS:617-65-2
xref: Beilstein:1723799
xref: Reaxys:4134100
xref: Gmelin:327903
xref: Beilstein:4134100
relationship: RO:0000087 CHEBI:78675
relationship: BFO:0000051 CHEBI:50329
comment: Parent CHEBI:78608 was rewired from CHEBI:14321 to CHEBI:33558; Parent CHEBI:62031 was rewired from CHEBI:18237 to CHEBI:26167
property_value: chemrof:inchi_string &#34;InChI=1S/C5H9NO4/c6-3(5(9)10)1-2-4(7)8/h3H,1-2,6H2,(H,7,8)(H,9,10)/p-1&#34; xsd:string
property_value: chemrof:has_physiologically_stable_form CHEBI:14321

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[99]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">bio_syn_map</span><span class="p">[</span><span class="n">ALPHA_AMINO_ACID_ZWITTERION</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[99]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;an alpha-amino acid&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[100]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">ont</span> <span class="o">=</span> <span class="n">Ontology</span><span class="p">(</span><span class="n">terms</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ont</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ontology: chebi-slim
idspace: chemrof https://w3id.org/chemrof/

[Term]
id: CHEBI:25944
name: pesticide
is_a: CHEBI:33232
xref: Wikipedia:Pesticide

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[101]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;tmp/t.obo&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ont</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[102]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">roots</span><span class="p">(</span><span class="n">terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Term</span><span class="p">]):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">terms</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">parents</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[103]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><br/><span></span><span class="k">def</span> <span class="nf">make_terms_for_ids</span><span class="p">(</span><span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Term</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make terms for a list of IDs</span>

<span class="sd">    :param ids:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">make_term</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> IDs, made </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span><span class="si">}</span><span class="s2"> terms&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">terms</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_terms</span><span class="p">(</span><span class="n">terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Term</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write terms to a file</span>

<span class="sd">    :param terms:</span>
<span class="sd">    :param path:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ont</span> <span class="o">=</span> <span class="n">Ontology</span><span class="p">(</span><span class="n">terms</span><span class="o">=</span><span class="n">terms</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ont</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[105]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_write_all</span><span class="p">(</span><span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Term</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run whole pipeline</span>

<span class="sd">    :param ids:</span>
<span class="sd">    :param path:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="n">make_terms_for_ids</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
    <span class="n">write_terms</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">terms</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">amino_acid_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chebi</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">AMINO_ACID</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">L_CYSTEINE_ZWITTERION</span> <span class="ow">in</span> <span class="n">amino_acid_ids</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">amino_acid_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[107]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">terms</span> <span class="o">=</span> <span class="n">generate_write_all</span><span class="p">(</span><span class="n">amino_acid_ids</span><span class="p">,</span> <span class="s2">&quot;tmp/amino_acids.obo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Processed 10000 IDs, made 7879 terms
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[108]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">terms</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">L_CYSTEINE_ZWITTERION</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Term]
id: CHEBI:35235
name: L-cysteine
alt_id: CHEBI:32442
alt_id: CHEBI:17561
alt_id: CHEBI:32445
alt_id: CHEBI:32443
is_a: CHEBI:35237
is_a: CHEBI:59869
is_a: CHEBI:26650
is_a: CHEBI:83813
xref: Gmelin:49993
xref: Reaxys:4128886
xref: Gmelin:325857
xref: Beilstein:4128886
xref: YMDB:YMDB00046
xref: Wikipedia:Cysteine
xref: Reaxys:1721408
xref: PDBeChem:CYS
xref: MetaCyc:CYS
xref: KNApSAcK:C00001351
xref: KEGG:D00026
xref: KEGG:C00097
xref: HMDB:HMDB0000574
xref: Gmelin:49991
xref: ECMDB:ECMDB00574
xref: Drug_Central:769
xref: DrugBank:DB00151
xref: CAS:52-90-4
xref: Beilstein:1721408
xref: Gmelin:325860
xref: Reaxys:5921923
xref: Gmelin:325856
xref: Beilstein:5921923
relationship: RO:0018039 CHEBI:35236
relationship: RO:0000087 CHEBI:78675
relationship: RO:0000087 CHEBI:64577
relationship: RO:0000087 CHEBI:77703
relationship: RO:0000087 CHEBI:77746
comment: Parent CHEBI:59869 was rewired from CHEBI:32442 to CHEBI:59814; Parent CHEBI:26650 was rewired from CHEBI:17561 to CHEBI:26650; Parent CHEBI:83813 was rewired from CHEBI:17561 to CHEBI:83813
property_value: chemrof:inchi_string &#34;InChI=1S/C3H7NO2S/c4-2(1-7)3(5)6/h2,7H,1,4H2,(H,5,6)/t2-/m0/s1&#34; xsd:string
property_value: chemrof:has_physiologically_stable_form CHEBI:35235

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[109]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">oaklib.datamodels.vocabulary</span> <span class="kn">import</span> <span class="n">OWL_CLASS</span>

<span class="c1"># all_ids = list(chebi.descendants(ROOT))</span>
<span class="n">all_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chebi</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="n">filter_obsoletes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">owl_type</span><span class="o">=</span><span class="n">OWL_CLASS</span><span class="p">))</span>
<span class="n">terms</span> <span class="o">=</span> <span class="n">generate_write_all</span><span class="p">(</span><span class="n">all_ids</span><span class="p">,</span> <span class="s2">&quot;tmp/all.obo&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Processed 10000 IDs, made 9955 terms
Processed 20000 IDs, made 19917 terms
Processed 30000 IDs, made 29878 terms
Processed 40000 IDs, made 38207 terms
Processed 50000 IDs, made 47129 terms
Processed 60000 IDs, made 56582 terms
Processed 70000 IDs, made 65929 terms
Processed 80000 IDs, made 75147 terms
Processed 90000 IDs, made 84597 terms
Processed 100000 IDs, made 93930 terms
Processed 110000 IDs, made 103890 terms
Processed 120000 IDs, made 113825 terms
Processed 130000 IDs, made 123784 terms
Processed 140000 IDs, made 132470 terms
Processed 150000 IDs, made 141078 terms
Processed 160000 IDs, made 149833 terms
Processed 170000 IDs, made 158566 terms
Processed 180000 IDs, made 166455 terms
Processed 190000 IDs, made 174804 terms
Processed 200000 IDs, made 184378 terms
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
185206
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># many roots expected when we make a subset</span>
<span class="nb">len</span><span class="p">(</span><span class="n">roots</span><span class="p">(</span><span class="n">terms</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
16
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1">#write_terms(terms, f&quot;tmp/{ROOT.replace(&#39;:&#39;, &#39;_&#39;)}.obo&quot;)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">fertirelin</span> <span class="o">=</span> <span class="s2">&quot;CHEBI:177856&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">make_term</span><span class="p">(</span><span class="n">fertirelin</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">as_obo</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Term]
id: CHEBI:177856
name: fertirelin
is_a: CHEBI:25676
xref: KEGG:D07957
xref: Chemspider:163670
xref: CAS:38234-21-8
property_value: chemrof:inchi_string &#34;InChI=1S/C55H76N16O12/c1-4-59-53(82)44-12-8-20-71(44)54(83)38(11-7-19-60-55(56)57)66-49(78)39(21-30(2)3)65-46(75)27-62-47(76)40(22-31-13-15-34(73)16-14-31)67-52(81)43(28-72)70-50(79)41(23-32-25-61-36-10-6-5-9-35(32)36)68-51(80)42(24-33-26-58-29-63-33)69-48(77)37-17-18-45(74)64-37/h5-6,9-10,13-16,25-26,29-30,37-44,61,72-73H,4,7-8,11-12,17-24,27-28H2,1-3H3,(H,58,63)(H,59,82)(H,62,76)(H,64,74)(H,65,75)(H,66,78)(H,67,81)(H,68,80)(H,69,77)(H,70,79)(H4,56,57,60)/t37-,38-,39-,40-,41-,42-,43-,44-/m0/s1&#34; xsd:string

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">chebi</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">is_a_map</span><span class="p">[</span><span class="n">fertirelin</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;oligopeptide&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CHEBI-Predicates.html" class="btn btn-neutral float-left" title="CHEBI Predicates" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../CL/index.html" class="btn btn-neutral float-right" title="CL Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, OAK developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>